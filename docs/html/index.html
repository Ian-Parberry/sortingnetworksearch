<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Sorting Network Search: Sorting Network Search</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">Sorting Network Search
   </div>
   <div id="projectbrief">Backtracking for Small Sorting Networks</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Sorting Network Search </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="section1"></a></p><h1>1. Introduction</h1>
<p >A <em>comparator network</em> consists of a fixed number of <em>channels</em> that carry scalar values from some strongly ordered set (usually integers or floating point numbers), and <em>comparators</em> that connect pairs of channels, swapping the values on the channels if they are not in a desired order. Comparator networks that sort all inputs are called <em>sorting networks</em>. See the <a href="https://en.wikipedia.org/wiki/Sorting_network">Wikipedia page</a> for more information.</p>
<p >This sorting network backtracking code, the source code of which is written and maintained by <a href="https://ianparberry.com">Ian Parberry</a>, can be used to search for sorting networks with a small number of inputs. Any sorting network found will be saved in the text format used by the sorting network viewer <a href="https://github.com/Ian-Parberry/sortingnetworkviewer">https://github.com/Ian-Parberry/sortingnetworkviewer</a>, which can then be used to display them in a window and export the image to a file in bitmap or vector graphic formats.</p>
<p >This code implements the algorithm from</p>
<blockquote class="doxtable">
<p >&zwj;I. Parberry, "A computer assisted optimal depth lower bound for nine-input sorting networks", <em>Mathematical Systems Theory</em>, Vol. 24, pp. 101-116, 1991. </p>
</blockquote>
<p>A preliminary version of this paper appeared in</p>
<blockquote class="doxtable">
<p >&zwj;I. Parberry, "A computer assisted optimal depth lower bound for nine-input sorting networks", Proceedings of Supercomputing '89, pp. 152-161, 1989. </p>
</blockquote>
<p>A free PDF version can be found at <a href="https://ianparberry.com/pubs/9-input.pdf">https://ianparberry.com/pubs/9-input.pdf</a>. It will henceforth be referred to in this documentation as <a href="https://ianparberry.com/pubs/9-input.pdf">the paper</a>.</p>
<p >Over a quarter of a century later, these results were cleverly expanded up to 20 inputs using a SAT solver in</p>
<blockquote class="doxtable">
<p >&zwj;D. Bundala, M. Codish, L. Cruz-Filipe, P. Schneider-Kamp, J. Závodný, "Optimal-depth sorting networks", <em>Journal of Computer and System Sciences</em>, Vol. 84, pp. 185-204, 2017. </p>
</blockquote>
<p>The original backtracking code from the 1980s has been lost to crashed floppy disks, hard drives and magnetic tapes. However, in the interest of completeness I have recreated it from <a href="https://ianparberry.com/pubs/9-input.pdf">the paper</a>. Any errors in this code do not imply errors in the original 1980s version.</p>
<p >The remainder of this page is divided into three sections. <a class="el" href="index.html#section2">Section 2</a> gives an overview of the code. <a class="el" href="index.html#section3">Section 3</a> describes some experimental results, and <a class="el" href="index.html#section4">Section 4</a> shows how to run the code.</p>
<hr  />
<p ><a class="anchor" id="section2"></a></p><h1>2. Code Overview</h1>
<p >This section is divided into four subsections. <a class="el" href="index.html#section2_1">Section 2.1</a> describes how settings are shared through the code. <a class="el" href="index.html#section2_2">Section 2.2</a> gives an overview of the hierarchy of sorting network classes used. <a class="el" href="index.html#section2_3">Section 2.3</a> describes the multithreading classes. <a class="el" href="index.html#section2_4">Section 2.4</a> puts together the classes described in the previous three subsections.</p>
<p ><a class="anchor" id="section2_1"></a></p><h2>2.1 Shared Settings</h2>
<p ><code><a class="el" href="class_c_settings.html" title="The common variables class.">CSettings</a></code>, shares settings <code>m_nWidth</code> (the number of inputs, or <em>width</em> of the sorting networks to be searched for) and <code>m_nDepth</code> (the number of levels, or depth of the sorting networks to be searched for). It is a singleton class that enables us to share these values quickly and transparently by using it as a base class. The maximum width and depth are constrained by sensible maximum values in <code><a class="el" href="_defines_8h.html" title="Useful definitions.">Defines.h</a></code>.</p>
<p ><a class="anchor" id="section2_2"></a></p><h2>2.2 Sorting Network Classes</h2>
<p >Sorting networks are represented by members of a collection of derived classes as shown in <a class="el" href="index.html#fig1">Fig. 1</a>.</p>
<p ><a class="anchor" id="fig1"></a></p><div class="image">
<img src="hierarchy.png" alt="" width="70%"/>
<div class="caption">
Fig. 1: Annotated inheritance diagram.</div></div>
<p >Each of these will be described in a separate subsubsection below.</p>
<h3>2.2.1 <code><a class="el" href="class_c_comparator_network.html" title="Comparator network.">CComparatorNetwork</a></code></h3>
<p ><code><a class="el" href="class_c_comparator_network.html" title="Comparator network.">CComparatorNetwork</a></code> represents a comparator network, that is, a network of comparators. It is derived from <code><a class="el" href="class_c_settings.html" title="The common variables class.">CSettings</a></code>. Since the search will iterate through all matchings at all levels, there is a danger of including <em>repeat comparators</em> that are duplicates of comparators in the previous level. <code><a class="el" href="class_c_comparator_network.html" title="Comparator network.">CComparatorNetwork</a></code> contains code that removes repeat comparators, and also code for saving a comparator network to a text file in the format used by the <a href="https://github.com/Ian-Parberry/sortingnetworkviewer">sorting network viewer</a>.</p>
<h3>2.2.2 <code><a class="el" href="class_c_sorting_network.html" title="Sorting network.">CSortingNetwork</a></code></h3>
<p ><code><a class="el" href="class_c_sorting_network.html" title="Sorting network.">CSortingNetwork</a></code> represents a sorting network, that is, a comparator network that sorts all inputs. It is derived from <code><a class="el" href="class_c_comparator_network.html" title="Comparator network.">CComparatorNetwork</a></code>. The main new function here is <code><a class="el" href="class_c_sorting_network.html#a4c226a351bf238dcb096f27eb793b759" title="Does it sort?">CSortingNetwork::Sorts()</a></code>, which returns <code>true</code> if the base comparator network sorts all inputs. This function uses the Zero-One Principle and a binary Gray code generator <code><a class="el" href="class_c_binary_gray_code.html" title="Binary reflected Gray code generator.">CBinaryGrayCode</a></code> to generate the test inputs. The main functions here are <code><a class="el" href="class_c_binary_gray_code.html#ac6f007e21ec85e5226298ba600b1cd2e" title="Get first code word.">CBinaryGrayCode::Initialize()</a></code> to initialize to the first (all zero) binary string, and <code><a class="el" href="class_c_binary_gray_code.html#a9038f50e9042355e4cd63f4769e69e33" title="Get next code word.">CBinaryGrayCode::Next()</a></code> to generate the next binary string (which differs from the previous one in exactly one bit, the index of which is returned).</p>
<h3>2.2.3 <code><a class="el" href="class_c1_n_f.html" title="Sorting network in first normal form.">C1NF</a></code></h3>
<p ><code><a class="el" href="class_c1_n_f.html" title="Sorting network in first normal form.">C1NF</a></code> represents a <em>first normal form</em> sorting network, which has comparators in the first level between channels 0-1, 2-3, 4-5, etc. It is derived from <code><a class="el" href="class_c_sorting_network.html" title="Sorting network.">CSortingNetwork</a></code> and has similar functionality, the most important modification being that <code><a class="el" href="class_c1_n_f.html#a8884c9027692cd6988c1fcfa58291ded" title="Does it sort all inputs?">C1NF::Sorts()</a></code>, which overrides the virtual function <code><a class="el" href="class_c_sorting_network.html#a4c226a351bf238dcb096f27eb793b759" title="Does it sort?">CSortingNetwork::Sorts()</a></code>, skips the first level and uses an instance of <code><a class="el" href="class_c_ternary_gray_code.html" title="Ternary reflected Gray code generator.">CTernaryGrayCode</a></code> instead of <code><a class="el" href="class_c_binary_gray_code.html" title="Binary reflected Gray code generator.">CBinaryGrayCode</a></code> to generate the inputs into the second level. Restricting our search to sorting networks in first normal form does no harm since every sorting network can be put into first normal form by permuting the channels and untwisting the comparators (see <a href="https://ianparberry.com/pubs/9-input.pdf">the paper</a>).</p>
<h3>2.2.4 <code><a class="el" href="class_c_searchable.html" title="Searchable sorting network.">CSearchable</a></code></h3>
<p ><code><a class="el" href="class_c_searchable.html" title="Searchable sorting network.">CSearchable</a></code> represents a searchable first normal form sorting network. It is derived from <code><a class="el" href="class_c1_n_f.html" title="Sorting network in first normal form.">C1NF</a></code>. The main function here is <code><a class="el" href="class_c_searchable.html#a36bc353559a126f7ff668c1def7ea196" title="Backtracking search.">CSearchable::Backtrack</a></code>, which iterates through all first normal form comparator networks of width <code><a class="el" href="class_c_settings.html#a31cfba1245694e88c6b1258df6938d0d" title="Comparator network width.">CSettings::m_nWidth</a></code> and depth <code><a class="el" href="class_c_settings.html#a6bdd1a60968afb5aded68f59c5a06f62" title="Comparator network depth.">CSettings::m_nDepth</a></code>, and outputs those that sort all inputs. Functions <code>FirstComparatorNetwork()</code> and <code>NextComparatorNetwork()</code> are used to iterate through all levels from the second level down. These are then tested using the virtual function <code>Sorts()</code> which for <code><a class="el" href="class_c_searchable.html" title="Searchable sorting network.">CSearchable</a></code> means <code><a class="el" href="class_c1_n_f.html#a8884c9027692cd6988c1fcfa58291ded" title="Does it sort all inputs?">C1NF::Sorts()</a></code>, although this may be overridden in classes derived from it. Iteration over a given level is handled by a new matching generation algorithm derived from a permutation generation algorithm (see <a href="https://ianparberry.com/pubs/9-input.pdf">the paper</a>), which for efficiency and clarity uses a second representation of a level in class <code><a class="el" href="class_c_matching.html" title="Perfect matching.">CMatching</a></code>. <code><a class="el" href="class_c_matching.html#a81f61e5a80e7185f5654455874808395" title="Initialize.">CMatching::Initialize()</a></code> generates the first matching and <code><a class="el" href="class_c_matching.html#a0741d1c552f189eeba8edd0607d48ac9" title="Advance to next matching.">CMatching::Next()</a></code> generates the next. The map array <code>CComparatorNetwork::m_nMatch</code> is kept in step by calling <code><a class="el" href="class_c_searchable.html#a9eb266189bb69ed0b0d47e47e326bb0d" title="Synchronize the two different matching representations.">CSearchable::SynchMatchingRepresentations()</a></code> after each new matching is generated.</p>
<h3>2.2.5 <code><a class="el" href="class_c2_n_f.html" title="Second normal form searchable sorting network.">C2NF</a></code></h3>
<p ><code><a class="el" href="class_c2_n_f.html" title="Second normal form searchable sorting network.">C2NF</a></code> represents a searchable <em>second normal form</em> sorting network. It is derived from <code><a class="el" href="class_c_searchable.html" title="Searchable sorting network.">CSearchable</a></code> and has similar functionality. However, its second level is provided as a parameter. An instance of <code><a class="el" href="class_c2_n_f.html" title="Second normal form searchable sorting network.">C2NF</a></code> (or a class derived from it) will be given to a separate thread to test whether it can be built out into a sorting network.</p>
<h3>2.2.6 <code><a class="el" href="class_c_autocomplete.html" title="Searchable second normal form sorting network with autocomplete.">CAutocomplete</a></code></h3>
<p ><code><a class="el" href="class_c_autocomplete.html" title="Searchable second normal form sorting network with autocomplete.">CAutocomplete</a></code> represents a searchable second normal form sorting network that constructs its last level (the one immediately before the outputs) instead of iterating through all possibilities. It is derived from <code><a class="el" href="class_c2_n_f.html" title="Second normal form searchable sorting network.">C2NF</a></code>. The last level is constructed using reachability, aborting if it is impossible to achieved in one level of comparators. Function <code><a class="el" href="class_c_autocomplete.html#a32852a024d5841d63b1ee260a3ee3312" title="Does it still sort when a bit is changed?">CAutocomplete::StillSorts()</a></code> is where this happens, overriding the much simpler two-line <code><a class="el" href="class_c1_n_f.html#abee85e48d615d883e441d1fd0768f70d" title="Does it still sort when a bit is changed?">C1NF::StillSorts</a></code>. See <a href="https://ianparberry.com/pubs/9-input.pdf">the paper</a> for more details.</p>
<h3>2.2.7 <code><a class="el" href="class_c_nearsort.html" title="Searchable sorting network with nearsort.">CNearsort</a></code></h3>
<p ><code><a class="el" href="class_c_nearsort.html" title="Searchable sorting network with nearsort.">CNearsort</a></code> represents a searchable second normal form sorting network that constructs its last level and prunes out at any second-from-last level that fails a reachability heuristic called <em>nearsort</em>. It is derived from <code><a class="el" href="class_c_autocomplete.html" title="Searchable second normal form sorting network with autocomplete.">CAutocomplete</a></code>. If a comparator network is rejected at the second-from-last level by the nearsort heuristic, then it is guaranteed that there is no last level that completes a sorting network. See <a href="https://ianparberry.com/pubs/9-input.pdf">the paper</a> for more details.</p>
<h3>2.2.8 <code><a class="el" href="class_c_nearsort2.html" title="Searchable sorting network with nearsort2.">CNearsort2</a></code></h3>
<p ><code><a class="el" href="class_c_nearsort2.html" title="Searchable sorting network with nearsort2.">CNearsort2</a></code> represents a searchable second normal form sorting network with nearsort that constructs its last level and prunes out at any third-from-last level that fails a reachability heuristic called <em>nearsort2</em>. It is derived from <code><a class="el" href="class_c_nearsort.html" title="Searchable sorting network with nearsort.">CNearsort</a></code>. If a comparator network is rejected at the third-from-last level by the nearsort2 heuristic, then it is guaranteed that there are no last two levels that complete a sorting network. The nearsort2 heuristic was invented after the publication of <a href="https://ianparberry.com/pubs/9-input.pdf">the paper</a>, however, it is the obvious extension of nearsort.</p>
<p ><a class="anchor" id="section2_3"></a></p><h2>2.3 Multithreading</h2>
<p >This code uses the <code>thread++</code> library from <a href="https://github.com/Ian-Parberry/threadplusplus">https://github.com/Ian-Parberry/threadplusplus</a>. We use a class <code><a class="el" href="class_c_task.html" title="Task.">CTask</a></code> derived from <code>CBaseTask</code> in <code>thread++</code>, adding a pointer to an instance of <code><a class="el" href="class_c_searchable.html" title="Searchable sorting network.">CSearchable</a></code> (or one of its derived classes) and an override <code><a class="el" href="class_c_task.html#abea2e5d18250f29911eba2186d2b126c" title="Perform the task.">CTask::Perform()</a></code> for <code>CBaseTask::Perform()</code> that calls the virtual function <code><a class="el" href="class_c_searchable.html#a36bc353559a126f7ff668c1def7ea196" title="Backtracking search.">CSearchable::Backtrack()</a></code> or the appropriate overriding function. We also use a thread manager class <code><a class="el" href="class_c_thread_manager.html" title="Thread manager.">CThreadManager</a></code> derived from <code>CBaseThreadManager</code> in <code>thread++</code>. This provides a function <code><a class="el" href="class_c_thread_manager.html#adaf7fe7061917f2fbaeecefec1d39c2f" title="Process the result of a task.">CThreadManager::ProcessTask()</a></code> that processes a task (an instance of <code><a class="el" href="class_c_task.html" title="Task.">CTask</a></code>) by adding to a global count the number of sorting networks found from searching the instance of <code><a class="el" href="class_c_searchable.html" title="Searchable sorting network.">CSearchable</a></code> pointed to by the task. Therefore, when all threads have terminated, <code><a class="el" href="class_c_thread_manager.html#ad1c01ec95494536f4d3591fd8beb0cdf" title="Number of comparator networks found that sort.">CThreadManager::m_nCount</a></code> contains the number of sorting networks found.</p>
<p ><a class="anchor" id="section2_4"></a></p><h2>2.4 Tying It All Together</h2>
<p >Function <code><a class="el" href="_main_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4" title="Main.">main()</a></code> prompts the user for the width and depth of the sorting networks (subject to the maxima in <code><a class="el" href="_defines_8h.html" title="Useful definitions.">Defines.h</a></code>) and whether the new nearsort2 heuristic is to be used. It then creates a thread manager (an instance of <code><a class="el" href="class_c_thread_manager.html" title="Thread manager.">CThreadManager</a></code>) and passes it to function <code><a class="el" href="_main_8cpp.html#a485049b9ff28ac293f0930e3778a2c4a" title="Multi-threaded search.">Search()</a></code>. This function uses an instance of <code><a class="el" href="class_c_level2_search.html" title="Level 2 search.">CLevel2Search</a></code> to generate an <code>std::vector&lt;<a class="el" href="class_c_matching.html" title="Perfect matching.">CMatching</a>&gt;</code> of candidate matchings for the second level unique up to permutation of pairs of channels. See <a href="https://ianparberry.com/pubs/9-input.pdf">the paper</a> for more details. For each second-level candidate an instance of <code><a class="el" href="class_c2_n_f.html" title="Second normal form searchable sorting network.">C2NF</a></code>, <code><a class="el" href="class_c_autocomplete.html" title="Searchable second normal form sorting network with autocomplete.">CAutocomplete</a></code>, <code><a class="el" href="class_c_nearsort.html" title="Searchable sorting network with nearsort.">CNearsort</a></code>, or <code><a class="el" href="class_c_nearsort2.html" title="Searchable sorting network with nearsort2.">CNearsort2</a></code> is created, wrapped up into an instance of <code><a class="el" href="class_c_task.html" title="Task.">CTask</a></code> and inserted into the thread manager's task queue. <code><a class="el" href="_main_8cpp.html#a485049b9ff28ac293f0930e3778a2c4a" title="Multi-threaded search.">Search()</a></code> then uses the thread manager to spawn the threads, with until the threads have terminated, then call its function <code>CBaseThreadManager::Process()</code> to process the results (which calls <code><a class="el" href="class_c_thread_manager.html#adaf7fe7061917f2fbaeecefec1d39c2f" title="Process the result of a task.">CThreadManager::ProcessTask()</a></code> for every processed task). The number of sorting networks found (which will have been output by the threads) is retrieved from the thread manager by calling the reader function <code><a class="el" href="class_c_thread_manager.html#a6beb5590866e8c105063b9535cb12d27" title="Get count.">CThreadManager::GetCount()</a></code>.</p>
<hr  />
<p ><a class="anchor" id="section3"></a></p><h1>3. Experimental Results</h1>
<p >The following experiments were run on an Intel&reg; Core&trade; i9-7980XE CPU @ 2.60GHz running Windows 11.</p>
<p >Proving that there are no 9-input sorting networks of depth 6 took 1.75 seconds elapsed time consisting of 48 seconds CPU time over 35 threads, without using the new nearsort2 heuristic. Considering that the original computation in the 1980s described in <a href="https://ianparberry.com/pubs/9-input.pdf">the paper</a> took over 200 hours of CRAY 2 time, this implies that my desktop computer is over 400,000 times faster than a 1980s supercomputer.</p>
<p >Proving that there are no 11-input sorting networks of depth 7 using the new nearsort2 heuristic took 2 days, 19 hr, 21 min sec elapsed time consisting of 88 days, 14 hr, 25 min CPU time over 35 threads using the new nearsort2 heuristic.</p>
<hr  />
<p ><a class="anchor" id="section4"></a></p><h1>4. Using the Code</h1>
<p >This project compiles into a console program that prompts the user for the number of inputs, the depth, and whether the new nearsort2 heuristic should be used. It reports the number of sorting networks found, the elapsed time, and the amount of CPU time summed over all threads (see <a class="el" href="index.html#fig2">Fig. 2</a>). It also appends this data to a text file <code>log.txt</code>. A new text file <code>level2-x.txt</code>, where <code>x</code> is the number of channels, is created listing the level 2 candidate matchings.</p>
<p ><a class="anchor" id="fig2"></a></p><div class="image">
<img src="sshot.png" alt="" width="50%"/>
<div class="caption">
Fig. 2: Console screen shot.</div></div>
 </div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri May 12 2023 15:08:40 for Sorting Network Search by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4
</small></address>
</body>
</html>
